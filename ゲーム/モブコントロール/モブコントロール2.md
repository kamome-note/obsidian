以下を参考に3Dゲームを作成する。
一通りの知識を学べる。

## 【自分の記事まとめ】ゲームエンジンGodot4.0でスマホ3Dゲームを作ってみる
https://qiita.com/FootInGlow/items/5754cee8f4c691cbc170

---

## 【Godot 4.0】スマホ3Dゲームを作るための勉強　その５　Godotエンジンによる衝突の制御
https://qiita.com/FootInGlow/items/a55b1137fc2a89b7aa20

|ノード|用途|
|---|---|
|StaticBody3D|動かないので、主に地形、壁、建物、固定オブジェクトの表現に適しています。|
|CharacterBody3D|移動やジャンプなどの自由な操作を実装することができますので、主にキャラクターやプレイヤーに適しています。|
|RigidBody3D|物理エンジンを使用した3Dオブジェクトのシミュレーションにより動きます。|
|Area3D|衝突せず通過しますが、他ノードの衝突（エリアに入る／出る）を検出することができます。|

### 衝突形状
衝突する形状はCollisionShape3Dに設定。

### RigidBody3D

RigidBody3Dで球体を設置。
実行すると落ちてゆく。

![[Pasted image 20250131001757.png]]

### StaticBody3D

StaticBody3Dで板を設置。
実行すると宙に浮く。

![[Pasted image 20250131002137.png]]

落下した球体は板の上で止まる。
![[Pasted image 20250131002252.png]]

板を傾けると転がる。
![[Pasted image 20250131002408.png]]

ボールを跳ねるようにする。
RigidBody3Dを選択して、インスペクタ内のRigidBody3D/Physics Materialのをクリックして新規PhysicsMaterialをクリック。
PhysicsMaterialをクリックするとBounceという項目があるので、0.5に変更。

![[Pasted image 20250131002803.png]]

ボールがバウンドしてから落ちてゆく。
![[Pasted image 20250131002839.png]]

### CharacterBody3D

CharacterBody3Dとして追加した立方体は空中で止まる。
動かすにはGDScriptで実装する必要あり。

![[Pasted image 20250131003302.png]]

テンプレート：CharacterBody3D:Basic Movementを指定して
スクリプトをアタッチする。

![[Pasted image 20250131003415.png]]
スペースでジャンプ、カーソルで移動するようになる。
![[Pasted image 20250131003603.png]]
```python
extends CharacterBody3D

const SPEED = 5.0
const JUMP_VELOCITY = 4.5

func _physics_process(delta: float) -> void:
	# Add the gravity.
	if not is_on_floor():
		velocity += get_gravity() * delta

	# Handle jump.
	if Input.is_action_just_pressed("ui_accept") and is_on_floor():
		velocity.y = JUMP_VELOCITY

	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	var input_dir := Input.get_vector("ui_left", "ui_right", "ui_up", "ui_down")
	var direction := (transform.basis * Vector3(input_dir.x, 0, input_dir.y)).normalized()
	if direction:
		velocity.x = direction.x * SPEED
		velocity.z = direction.z * SPEED
	else:
		velocity.x = move_toward(velocity.x, 0, SPEED)
		velocity.z = move_toward(velocity.z, 0, SPEED)

	move_and_slide()
```

### Area3D

Area3Dを追加しても物体は通り抜ける。
あくまでエリアに入ったかどうかを判定するためのノードだから。

![[Pasted image 20250131004019.png]]

---

## 【Godot 4.0】スマホ3Dゲームを作るための勉強　その６　CharacterBody3Dを動かしましょう
https://qiita.com/FootInGlow/items/8287ebe80d1eeb5aebb8

### move_and_slide

```python
extends CharacterBody3D

func _physics_process(delta):
	velocity = Vector3(0.0, 0.0, -1.0).normalized()
	move_and_slide()
	print(velocity)
```

- `extends CharacterBody3D`  
    　CharacterBody3Dを継承。
- `func _physics_process(delta):` 
    　`_process`ではなく、`_physics_process`メソッドを使用。  
    　物理エンジンの演算結果（現在位置、向き、速度など）を使用するまたは、動きの指示をする場合は、`_physics_process`メソッドの中で実行。
- `velocity = Vector3(0.0, 0.0, -1.0).normalized()`  
    　速度を設定。単位はm/s。
- `move_and_slide()`  
    　設定した速度でノードを動かすように物理エンジンに依頼。  
    　衝突なので速度に変化があった場合、velocityが上書きされる。

### move_and_collide

突したときの動きを実装したい場合、move_and_collideを使用。

```python
extends CharacterBody3D

func _ready():
	velocity = Vector3(0.0, 0.0, -1.0) 

func _physics_process(delta):
	var collision_info = move_and_collide(velocity.normalized() * delta)
	if collision_info:
		velocity = velocity.bounce(collision_info.get_normal())

```

- `move_and_collide(m_velocity.normalized() * delta)`  
	　`move_and_collide`の場合は、引数に経過時間(delta)あたりの移動量を設定。
- `var collision_info = move_and_collide(velocity.normalized() * delta)`  
    　衝突情報として`KinematicCollision3D`データが返却される。
- `if collision_info:`  
    　衝突した場合`collision_info`には何か設定されるので`true`になる。
- `velocity = velocity.bounce(collision_info.get_normal())`  
    　`collision_info.get_normal()`で衝突面（の法線）を取得。`normalized`（正規化）とは別物。  
    　`velocity.bounce`で衝突面に反発するような速度を取得。

---

## 【Godot 4.0】スマホ3Dゲームを作るための勉強　その７　3D空間のタッチしたところに移動したい
https://qiita.com/FootInGlow/items/564dfe87dc7fc5135c67

タッチした座標は画面上の2次元の座標だが、ノードは3D空間に存在するため変換が必要。


